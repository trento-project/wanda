<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.30.9">
    <meta name="project" content="Wanda v1.1.0">

    <title>Gatherers — Wanda v1.1.0</title>
    <link rel="stylesheet" href="dist/html-elixir-XFYN5IVA.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-EPF2X7PV.js"></script>
    <script src="dist/sidebar_items-05B55562.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-J2ASZTQE.js"></script>


  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">
  <form class="sidebar-search" action="search.html">
    <label class="search-label">
      <span class="sr-only">Search documentation of Wanda</span>
      <input name="q" type="text" class="search-input" placeholder="Search..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </label>
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
      <i class="ri-close-line ri-lg" title="Cancel search"></i>
    </button>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="readme.html">
        <img src="assets/logo.svg" alt="Wanda" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="readme.html" class="sidebar-projectName" translate="no">
Wanda
      </a>
      <div class="sidebar-projectVersion" translate="no">
        v1.1.0
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="icon-action display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/trento-project/wanda/blob/main/guides/gatherers.md#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>


  <span>Gatherers</span>
</h1>

<h2 id="introduction" class="section-heading">
  <a href="#introduction" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Introduction</span>
</h2>
<p>Gatherers can be thought of as functions:</p><ul><li>they have a name</li><li>they accept argument(s)</li><li>they return a value, the gathered <a href="specification.html#facts">Fact</a></li></ul><p>Facts Gathering process in a nutshell</p><pre><code class="makeup elixir" translate="no"><span class="n">fact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gatherer</span><span class="p" data-group-id="6142805394-1">(</span><span class="n">argument</span><span class="p" data-group-id="6142805394-1">)</span></code></pre><h2 id="gatherers-versioning" class="section-heading">
  <a href="#gatherers-versioning" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Gatherers versioning</span>
</h2>
<p>The gatherers implementation supports a versioning mechanism in order to enable non-backwards compatibility changes in any of them. When an update to
the trento-agent includes a non-backwards compatible change in a gatherer (e.g., changes to the Rhai output format), its version is
bumped by incrementing the @vN suffix that follows the gatherer's name, where 'N' represents the new version of that gatherer.
Example:</p><ul><li><code class="inline">systemd@v1</code> -&gt; Represents the first version of the systemd gatherer</li><li><code class="inline">systemd@v2</code> -&gt; Represents the second version of the systemd gatherer</li></ul><p>Note that when writing a check, if no tag is specified (e.g. <code class="inline">systemd</code>), the latest version is used. It is <strong>strongly</strong> recommended to always pin your
checks to a specific version of a gatherer.</p><p>Not all changes in a released gatherer get a new version tag. A new version tag is released only for breaking changes, while non-breaking changes such
as additional fields in the Rhai output reuse the latest existing tag. To use a check that relies on a newer field introduced after an update, upgrade
the agent to the latest version to ensure that the required gatherers are also up-to-date.</p><h2 id="available-gatherers" class="section-heading">
  <a href="#available-gatherers" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Available Gatherers</span>
</h2>
<p>Here's a collection of built-in gatherers, with information about how to use them.</p><table><thead><tr><th style="text-align: left;">Name</th><th style="text-align: left;">Implementation</th></tr></thead><tbody><tr><td style="text-align: left;"><a href="#cibadminv1"><code class="inline">cibadmin@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/cibadmin.go">trento-project/agent/../gatherers/cibadmin.go</a></td></tr><tr><td style="text-align: left;"><a href="#corosyncconfv1"><code class="inline">corosync.conf@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/corosyncconf.go">trento-project/agent/../gatherers/corosyncconf.go</a></td></tr><tr><td style="text-align: left;"><a href="#corosync-cmapctlv1"><code class="inline">corosync-cmapctl@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/corosynccmapctl.go">trento-project/agent/../gatherers/corosynccmapctl.go</a></td></tr><tr><td style="text-align: left;"><a href="#dir_scanv1"><code class="inline">dir_scan@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/dir_scan.go">trento-project/agent/../gatherers/dir_scan.go</a></td></tr><tr><td style="text-align: left;"><a href="#dispworkv1"><code class="inline">disp+work@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/dispwork.go">trento-project/agent/../gatherers/dispwork.go</a></td></tr><tr><td style="text-align: left;"><a href="#fstabv1"><code class="inline">fstab@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/fstab.go">trento-project/agent/../gatherers/fstab.go</a></td></tr><tr><td style="text-align: left;"><a href="#groupsv1"><code class="inline">groups@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/groups.go">trento-project/agent/../gatherers/groups.go</a></td></tr><tr><td style="text-align: left;"><a href="#hostsv1"><code class="inline">hosts@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/hostsfile.go">trento-project/agent/../gatherers/hostsfile.go</a></td></tr><tr><td style="text-align: left;"><a href="#package_versionv1"><code class="inline">package_version@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/packageversion.go">trento-project/agent/../gatherers/packageversion.go</a></td></tr><tr><td style="text-align: left;"><a href="#passwdv1"><code class="inline">passwd@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/passwd.go">trento-project/agent/../gatherers/passwd.go</a></td></tr><tr><td style="text-align: left;"><a href="#sapcontrolv1"><code class="inline">sapcontrol@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/sapcontrol.go">trento-project/agent/../gatherers/sapcontrol.go</a></td></tr><tr><td style="text-align: left;"><a href="#saphostctrlv1"><code class="inline">saphostctrl@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/saphostctrl.go">trento-project/agent/../gatherers/saphostctrl.go</a></td></tr><tr><td style="text-align: left;"><a href="#sap_profilesv1"><code class="inline">sap_profiles@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/sapprofiles.go">trento-project/agent/../gatherers/sapprofiles.go</a></td></tr><tr><td style="text-align: left;"><a href="#sapinstance_hostname_resolverv1"><code class="inline">sapinstance_hostname_resolver@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/sapinstancehostnameresolver.go">trento-project/agent/../gatherers/sapinstancehostnameresolver.go</a></td></tr><tr><td style="text-align: left;"><a href="#saptunev1"><code class="inline">saptune@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/saptune.go">trento-project/agent/../gatherers/saptune.go</a></td></tr><tr><td style="text-align: left;"><a href="#sbd_configv1"><code class="inline">sbd_config@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/sbd.go">trento-project/agent/../gatherers/sbd.go</a></td></tr><tr><td style="text-align: left;"><a href="#sbd_dumpv1"><code class="inline">sbd_dump@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/sbddump.go">trento-project/agent/../gatherers/sbddump.go</a></td></tr><tr><td style="text-align: left;"><a href="#sysctlv1"><code class="inline">sysctl@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/sysctl.go">trento-project/agent/../gatherers/sysctl.go</a></td></tr><tr><td style="text-align: left;"><a href="#systemdv1"><code class="inline">systemd@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/systemd.go">trento-project/agent/../gatherers/systemd.go</a></td></tr><tr><td style="text-align: left;"><a href="#systemdv2"><code class="inline">systemd@v2</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/systemd_v2.go">trento-project/agent/../gatherers/systemd_v2.go</a></td></tr><tr><td style="text-align: left;"><a href="#verify_passwordv1"><code class="inline">verify_password@v1</code></a></td><td style="text-align: left;"><a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/verifypassword.go">trento-project/agent/../gatherers/verifypassword.go</a></td></tr></tbody></table><span id="cibadminv1"></span><h3 id="cibadmin-v1" class="section-heading">
  <a href="#cibadmin-v1" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">cibadmin@v1</span>
</h3>
<p><strong>Argument required</strong>: no.</p><p>This gatherer allows accessing Pacemaker's CIB information, the output of the <code class="inline">cibadmin</code> command more precisely.
As the <code class="inline">cibadmin</code> command output is in XML format, the gatherer converts it to map/dictionary type format, so the fields are available with the normal dot access way.
Some specific fields, such as <code class="inline">primitive</code>, <code class="inline">clone</code>, <code class="inline">master</code>, etc (find the complete list <a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/cibadmin.go#L48">here</a>) are converted to lists, in order to avoid differences when the field appears one or multiple times.</p><p>Example arguments:</p><table><thead><tr><th style="text-align: left;">Name</th><th style="text-align: left;">Return value</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">cib.configuration</code></td><td style="text-align: left;">complete cib configuration entry as a map</td></tr><tr><td style="text-align: left;"><code class="inline">cib.configuration.resources.primitive.0</code></td><td style="text-align: left;">first available primitive resource</td></tr><tr><td style="text-align: left;"><code class="inline">cib.configuration.crm_config.cluster_property_set.0.nvpair.1</code></td><td style="text-align: left;">second nvpair value from the first element of cluster_property_set</td></tr></tbody></table><p>Example specification:</p><pre><code class="yaml">facts:
  - name: cib_configuration
    gatherer: cibadmin
    argument: cib.configuration

  - name: first_primitive
    gatherer: cibadmin
    argument: cib.configuration.resources.primitive.0

  - name: first_cluster_property_set_second_nvpair
    gatherer: cibadmin
    argument: cib.configuration.crm_config.cluster_property_set.0.nvpair.1</code></pre><p>Example output (in Rhai):</p><pre><code class="ts">// first_primitive
#{
    class: &quot;stonith&quot;,
    id: &quot;stonith-sbd&quot;,
    instance_attributes: #{
        id: &quot;stonith-sbd-instance_attributes&quot;,
        nvpair: [#{
            id: &quot;stonith-sbd-instance_attributes-pcmk_delay_max&quot;,
            name: &quot;pcmk_delay_max&quot;,
            value: &quot;30s&quot;
        }]
    },
    type: &quot;external/sbd&quot;
};

// first_cluster_property_set_second_nvpair
#{
    id: &quot;cib-bootstrap-options-dc-version&quot;,
    name: &quot;dc-version&quot;,
    value: &quot;2.0.4+20200616.2deceaa3a-3.12.1-2.0.4+20200616.2deceaa3a&quot;
};</code></pre><span id="corosyncconfv1"></span><h3 id="corosync-conf-v1" class="section-heading">
  <a href="#corosync-conf-v1" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">corosync.conf@v1</span>
</h3>
<p><strong>Argument required</strong>: no.</p><p>This gatherer allows accessing the information contained in <code class="inline">/etc/corosync/corosync.conf</code></p><p>Example arguments:</p><table><thead><tr><th style="text-align: left;">Name</th><th style="text-align: left;">Return value</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">totem.token</code></td><td style="text-align: left;">extracted value from the config</td></tr><tr><td style="text-align: left;"><code class="inline">totem.join</code></td><td style="text-align: left;">extracted value from the config</td></tr><tr><td style="text-align: left;"><code class="inline">nodelist.node.&lt;node_index&gt;.nodeid</code></td><td style="text-align: left;">extracted value from the config</td></tr><tr><td style="text-align: left;"><code class="inline">nodelist.node</code></td><td style="text-align: left;">list of objects representing the nodes</td></tr></tbody></table><p>Example specification:</p><pre><code class="yaml">facts:
  - name: corosync_token_timeout
    gatherer: corosync.conf
    argument: totem.token

  - name: corosync_join
    gatherer: corosync.conf
    argument: totem.join

  - name: corosync_node_id_0
    gatherer: corosync.conf
    argument: nodelist.node.0.nodeid

  - name: corosync_node_id_1
    gatherer: corosync.conf
    argument: nodelist.node.1.nodeid

  - name: corosync_nodes
    gatherer: corosync.conf
    argument: nodelist.node</code></pre><p>Example output (in Rhai):</p><pre><code class="ts">// corosync_token_timeout
30000;

// corosync_join
60;

// corosync_node_id_0
1;

// corosync_node_id_1
2;

// corosync_nodes
[#{nodeid: 1, ring0_addr: &quot;192.168.157.10&quot;}, #{nodeid: 2, ring0_addr: &quot;192.168.157.11&quot;}];</code></pre><p>For extra information refer to <a href="https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/corosyncconf_test.go">trento-project/agent/../gatherers/corosyncconf_test.go</a></p><span id="corosync-cmapctlv1"></span><h3 id="corosync-cmapctl-v1" class="section-heading">
  <a href="#corosync-cmapctl-v1" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">corosync-cmapctl@v1</span>
</h3>
<p><strong>Argument required</strong>: yes.</p><p>This gatherer allows accessing the output of the <code class="inline">corosync-cmapctl</code> tool. It supports all of the keys returned by it to be queried.</p><p>Example arguments:</p><table><thead><tr><th style="text-align: left;">Name</th><th style="text-align: left;">Return value</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">totem.token</code></td><td style="text-align: left;">extracted value from the command</td></tr><tr><td style="text-align: left;"><code class="inline">runtime.config.totem.token</code></td><td style="text-align: left;">extracted value from the command</td></tr><tr><td style="text-align: left;"><code class="inline">totem.transport</code></td><td style="text-align: left;">extracted value from the command</td></tr><tr><td style="text-align: left;"><code class="inline">runtime.config.totem.max_messages</code></td><td style="text-align: left;">extracted value from the command</td></tr><tr><td style="text-align: left;"><code class="inline">nodelist.node.0.ring0_addr</code></td><td style="text-align: left;">extracted value from the command</td></tr><tr><td style="text-align: left;"><code class="inline">nodelist.node</code></td><td style="text-align: left;">extracted value from the command</td></tr><tr><td style="text-align: left;"><code class="inline">nodelist.node.1</code></td><td style="text-align: left;">extracted value from the command</td></tr></tbody></table><p>Example specification:</p><pre><code class="yaml">facts:
  - name: totem_token
    gatherer: corosync-cmapctl
    argument: totem.token

  - name: runtime_totem_token
    gatherer: corosync-cmapctl
    argument: runtime.config.totem.token

  - name: totem_transport
    gatherer: corosync-cmapctl
    argument: totem.transport

  - name: totem_max_messages
    gatherer: corosync-cmapctl
    argument: runtime.config.totem.max_messages

  - name: node_0_ring0addr
    gatherer: corosync-cmapctl
    argument: nodelist.node.0.ring0_addr

  - name: node_list
    gatherer: corosync-cmapctl
    argument: nodelist.node

  - name: second_node
    gatherer: corosync-cmapctl
    argument: nodelist.node.1</code></pre><p>Example output (in Rhai):</p><pre><code class="ts">// totem_token
30000;

// runtime_totem_token
30000;

// totem_transport
&quot;udpu&quot;;

// totem_max_messages
20;

// node_0_ring0addr
&quot;10.80.1.11&quot;;

// node_list
#{
  &quot;0&quot;: #{
    nodeid: 1,
    ring0_addr: &quot;10.80.1.11&quot;
  },
  &quot;1&quot;: #{
    nodeid: 2,
    ring0_addr: &quot;10.80.1.12&quot;
  }
};

// second_node
#{ nodeid: 2, ring0_addr: &quot;10.80.1.12&quot; };</code></pre><span id="dir_scanv1"></span><h3 id="dir_scan-v1" class="section-heading">
  <a href="#dir_scan-v1" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">dir_scan@v1</span>
</h3>
<p><strong>Argument required</strong>: Yes</p><p>This gatherer allows to scan directories with a glob pattern provided as argument.
The gatherer returns a list of files matched by the pattern with group/user information associated to each file.</p><p>Example argument:</p><ul><li><code class="inline">/usr/sap/[A-Z][A-Z0-9][A-Z0-9]/ERS[0-9][0-9]</code></li><li><code class="inline">/etc/polkit-1/rules.d/[0-9][0-9]-SAP[A-Z][A-Z0-9][A-Z0-9]-[0-9][0-9].rules</code></li></ul><p>Example specification:</p><pre><code class="yaml">facts:
  - name: dir_scan
    gatherer: dir_scan
    argument: &quot;/usr/sap/[A-Z][A-Z0-9][A-Z0-9]/ERS[0-9][0-9]&quot;</code></pre><p>Example output (in Rhai):</p><pre><code class="ts">  [
    #{
      &quot;name&quot;: &quot;/usr/sap/PRD/ERS01&quot;,
      &quot;owner&quot;: &quot;trento&quot;,
      &quot;group&quot;: &quot;trento&quot;
    },
     #{
      &quot;name&quot;: &quot;/usr/sap/QAS/ERS02&quot;,
      &quot;owner&quot;: &quot;trento&quot;,
      &quot;group&quot;: &quot;trento&quot;
    },
  ]</code></pre><span id="dispworkv1"></span
### disp+work@v1

**Argument required**: No

This gatherer allows access to the `disp+work` command output and returns some fields available there.
The command is executed for all installed SAP systems, accessing it with the `<sid>adm` user. The fields for
each system are returned in a map using the SAP sid as key.

If the `disp+work` command execution fails, the fields are returned with an empty string value.

The available fields are `compilation_mode`, `kernel_release` and `patch_number`.

Example specification:

```yaml
facts:
  - name: dispwork
    gatherer: disp+work
```

Example output (in Rhai):

```ts
#{
  "NWP": #{
    "compilation_mode": "UNICODE",
    "kernel_release": "753",
    "patch_number": "900"
  },
  // failed execution
  "NWQ": #{
    "compilation_mode": "",
    "kernel_release": "",
    "patch_number": ""
  },
  "NWD": #{
    "compilation_mode": "UNICODE",
    "kernel_release": "753",
    "patch_number": "910"
  }
} 
```

<span id="fstabv1"></span>

### fstab@v1

**Argument required**: no.

This gatherer allows access to the /etc/fstab file, returning all entries available at the file.

Example specification:

```yaml
facts:
  - name: fstab
    gatherer: fstab
```

Example output (in Rhai):

```ts
[
    #{
        "device": "/dev/system/root",
        "mount_point": "/",
        "file_system_type": "btrfs",
        "options": [],
        "backup": 0,
        "check_order": 1,
    },
    #{
        "device": "/dev/system/root",
        "mount_point": "/home",
        "file_system_type": "ext4",
        "options": ["defaults"],
        "backup": 0,
        "check_order": 1,
    },
  ...
];
```

<span id="groupsv1"></span>

### groups@v1

**Argument required**: no.

This gatherer allows access to the /etc/group file, returning all entries available at the file.

Example specification:

```yaml
facts:
  - name: groups
    gatherer: groups
```

Example output (in Rhai):

```ts
[
    #{
        "name": "root",
        "gid": 0,
        "users": [],
    },
    #{
        "name": "adm",
        "gid": 1,
        "users": ["trento"],
    }
  ...
];
```

<span id="hostsv1"></span>

### hosts@v1

**Argument required**: no.

This gatherer allows accessing the hostnames that are resolvable through `/etc/hosts`. It
does **not** use domain resolution in any way but instead directly parses the file.

It allows one argument to be specified or none at all:

- When a hostname is provided as an argument, the gatherer will return an array of IPv4 and/or IPv6 addresses.
- When no argument is provided, the gatherer will return a map with hostname as keys and arrays with IPv4 and/or IPv6 addresses.

Example arguments:

| Name                   | Return value                        |
| :--------------------- | :---------------------------------- |
| `localhost`            | list of IPs resolving               |
| `node1`                | list of IPs resolving               |
| `no argument provided` | map with hostnames and IP addresses |

Example specification:

```yaml
facts:
  - name: hosts_node1
    gatherer: hosts
    argument: node1

  - name: hosts_node2
    gatherer: hosts
    argument: node2

  - name: hosts_all
    gatherer: hosts
```

Example output (in Rhai):

```ts
// hosts_node1
["127.0.0.1", "::1"];

// hosts_node2
["192.168.157.11"];

// hosts_all
#{
  "localhost": ["127.0.0.1", "::1"],
  "node1": ["192.168.157.10"],
  "node2": ["192.168.157.11"],
  ...
};
```

<span id="package_versionv1"></span>

### package_version@v1

**Argument required**: yes.

This gatherer supports two usecases:

- get information about the installed versions of the specified package.
- compare a given version string against the latest installed version of a given package.

In the first usecase a list of objects is returned, where each object carries relevant information about an installed version of a package.

> Note:
>
> - a list of one element is often expected since usually the installed version would be only one
> - detected installed versions list is ordered by descending installation time: **latest installed versions come first**
> - operating on the latest installed version requires accessing the first element in the list via `package_fact_name[0]` or `package_fact_name.first()`

In the second usecase, the return value is as follows (see additional details [here](https://fedoraproject.org/wiki/Archive:Tools/RPM/VersionComparison#The_rpmvercmp_algorithm)):

- A value of `0` if the provided version string matches the installed package version for the requested package.
- A value of `-1` if the provided version string is older that what's currently installed.
- A value of `1` if the provided version string is newer than what's currently installed.

> The latest detected installed version is used for comparison

Naming the facts / expectations accordingly is specially important here to avoid confusion.

- We suggest using a `compare_` prefix for package version comparisons and `package_` to retrieve
  a package version

Additionally, when using the version comparison, it increases readability to explicitly mention
the values to compare against:

```yaml
facts:
  - name: compare_package_corosync
    gatherer: package_version
    argument: corosync,2.4.5

  - name: package_corosync
    gatherer: package_version
    argument: corosync

  - name: package_sbd
    gatherer: package_version
    argument: sbd

values:
  - name: greater_than_installed
    default: 1
  - name: lesser_than_installed
    default: -1
  - name: same_as_installed
    default: 0
  - name: expected_corosync_version
    default: "2.4.5"

expectations:
  - name: compare_package_corosync
    expect: facts.compare_package_corosync == values.greater_than_installed

  - name: package_corosync_is_the_expected_one
    expect: facts.package_corosync.first().version == values.expected_corosync_version

  - name: sbd_version_same_on_all_hosts
    expect_same: facts.package_sbd.first().version
```

Example arguments:

| Name                 | Return value                                                                  |
| :------------------- | :---------------------------------------------------------------------------- |
| `package_name`       | a list containing information about the installed versions of the rpm package |
| `package_name,2.4.5` | an integer with a value of `-1`, `0` or `1` (see above)                       |

Example specification:

```yaml
facts:
  - name: package_corosync
    gatherer: package_version
    argument: corosync

  - name: package_pacemaker
    gatherer: package_version
    argument: pacemaker

  - name: multiple_sbd_versions_installed
    gatherer: package_version
    argument: sbd

  - name: compare_package_corosync
    gatherer: package_version
    argument: corosync,2.4.5

  ...
```

Example output (in Rhai):

```ts
// package_corosync
[
  #{
    "version": "2.4.5"
  }
]

// package_pacemaker
[
  #{
    "version": "2.0.4+20200616.2deceaa3a"
  }
]

// multiple_sbd_versions_installed
[
  #{
    "version": "1.5.1" // latest installed version, not necessarily the newest one
  },
  #{
    "version": "1.5.2"
  }
]

// compare_package_corosync
0
```

<span id="passwdv1"></span>

### passwd@v1

**Argument required**: no.

This gatherer allows access to the /etc/passwd file, returning all entries available at the file.

Example specification:

```yaml
facts:
  - name: passwd
    gatherer: passwd
```

Example output (in Rhai):

```ts
[
    #{
        "description": "bin",
        "gid": 1,
        "home": "/bin",
        "shell": "/sbin/nologin",
        "uid": 1,
        "user": "bin"
    },
    #{
        "description": "Chrony Daemon",
        "gid": 475,
        "home": "/var/lib/chrony",
        "shell": "/bin/false",
        "uid": 474,
        "user": "chrony"
    },
    #{
        "description": "Daemon",
        "gid": 2,
        "home": "/sbin",
        "shell": "/sbin/nologin",
        "uid": 2,
        "user": "daemon"
    },
  ...
];
```

<span id="sapcontrolv1"></span>

### sapcontrol@v1

**Argument required**: yes.

This gatherer allows access to certain webmethods that `sapcontrol` implements. An argument is required to specify which webmethod should be called. The communication with `sapcontrol` is created opening a unix socket connection using the file `/tmp/.sapstream5xx13`. The [Sapcontrol Web Service Interface](https://www.sap.com/documents/2016/09/0a40e60d-8b7c-0010-82c7-eda71af511fa.html) documents the SOAP API interface, including all the possible values each of the fields could have, specifically helpful for enumerators like `dispstatus` in `GetProcessList` and `state/category` in `HACheckConfig` webmethod.

The return value is grouped by discovered SIDs, which include the list of command outputs for each instance in this system.

Supported webmethods:

- `GetProcessList`
- `GetSystemInstanceList`
- `GetVersionInfo`
- `HACheckConfig`
- `HAGetFailoverConfig`

Example specification:

```yaml
facts:
  - name: processes
    gatherer: sapcontrol
    argument: GetProcessList

  - name: instances
    gatherer: sapcontrol
    argument: GetSystemInstanceList
```

Example output (in Rhai):

```ts
// GetProcessList
#{
  "NWP": [
    #{
      "instance_nr": "10",
      "name": "ERS10",
      "output": [
        #{
          "description": "EnqueueReplicator",
          "dispstatus": "SAPControl-GREEN",
          "elapsedtime": "266:08:15",
          "name": "enrepserver",
          "pid": 7221,
          "starttime": "2023 09 29 09:41:41",
          "textstatus": "Running"
        }
      ]
    }
  ]
}

// GetSystemInstanceList
#{
  "NWP": [
    #{
      "instance_nr": "10",
      "name": "ERS10",
      "output": [
        #{
          "dispstatus": "SAPControl-GREEN",
          "features": "MESSAGESERVER|ENQUE",
          "hostname": "sapnwpas",
          "http_port": 50013,
          "https_port": 50014,
          "instance_nr": 0,
          "start_priority": "1"
        },
        #{
          "dispstatus": "SAPControl-GREEN",
          "features": "ENQREP",
          "hostname": "sapnwper",
          "http_port": 51013,
          "https_port": 51014,
          "instance_nr": 10,
          "start_priority": "0.5"
        },
        ...
      ]
    }
  ]
}

// GetVersionInfo
#{
  "NWP": [
    #{
      "instance_nr": "10",
      "name": "ERS10",
      "output": [
        #{
          "architecture": "linuxx86_64",
          "build": "optU (Oct 16 2021, 00:03:15)",
          "changelist": "2094654",
          "filename": "/usr/sap/NWP/ERS10/exe/sapstartsrv",
          "patch": "900",
          "rks_compatibility_level": "1",
          "sap_kernel": "753",
          "time": "2021 10 15 22:14:31"
        },
        #{
          "architecture": "linuxx86_64",
          "build": "optU (Oct 16 2021, 00:03:15)",
          "changelist": "2094654",
          "filename": "/usr/sap/NWP/ERS10/exe/gwrd",
          "patch": "900",
          "rks_compatibility_level": "1",
          "sap_kernel": "753",
          "time": "2021 10 15 22:04:14"
        },
        ...
      ]
    }
  ]
}

// HACheckConfig
#{
  "NWP": [
    #{
      "instance_nr": "10",
      "name": "ERS10",
      "output": [
        #{
          "category": "SAPControl-SAP-CONFIGURATION",
          "comment": "2 ABAP instances detected",
          "description": "Redundant ABAP instance configuration",
          "state": "SAPControl-HA-SUCCESS"
        },
        #{
          "category": "SAPControl-SAP-CONFIGURATION",
          "comment": "0 Java instances detected",
          "description": "Redundant Java instance configuration",
          "state": "SAPControl-HA-SUCCESS"
        },
        ...
      ]
    }
  ]
}

//HAGetFailoverConfig
#{
  "NWP": [
    #{
      "instance_nr": "10",
      "name": "ERS10",
      "output": #{
        "ha_active": false,
        "ha_active_nodes": "",
        "ha_documentation": "",
        "ha_nodes": [],
        "ha_product_version": "",
        "ha_sap_interface_version": ""
      }
    }
  ]
}

```

<span id="saphostctrlv1"></span>

### saphostctrl@v1

**Argument required**: yes.

This gatherer allows access to certain webmethods that `saphostctrl` implements. An argument is required to specify
which webmethod should be called. This webmethod is passed to the `saphostctrl` command-line tool through the `-function` argument.

Supported webmethods:

- `Ping`
- `ListInstances`

A `Ping` call with a successful return should look like this:

Example specification:

```yaml
facts:
  - name: ping
    gatherer: saphostctrl
    argument: Ping

  - name: list_instances
    gatherer: saphostctrl
    argument: ListInstances
```

Example output (in Rhai):

```ts
// ping
#{elapsed: 579770.0, status: "SUCCESS"}

// list_instances
[
    #{
        "changelist": 1908545,
        "hostname": "vmhana01",
        "instance": "00",
        "patch": 410,
        "sapkernel": 753,
        "system": "PRD"
    }
];
```

<span id="sapinstance_hostname_resolverv1"></span>

### sapinstance_hostname_resolver@v1

**Argument required**: no.

This gatherer uses the filesystem to search for sap systems using the discovered profile file names to get the virtual hostnames associated to each
instance of the sap system. It will then attempt to resolve those hostnames to confirm that they are resolvable and afterwards it will attempt a ping
to those hostnames. Keep in mind that ping could be disallowed through firewall rules so it should only be used for networks in which we know this is
not true.

Example specification:

```yaml
facts:
  - name: resolvability_check
    gatherer: sapinstance_hostname_resolver
```

Example output (in Rhai):

```ts
#{
  "QAS": [
    #{
      "addresses": [
        "1.1.1.82"
      ],
      "hostname": "sapqasas",
      "instance_name": "ASCS00",
      "reachability": true
    },
    #{
      "addresses": (),
      "hostname": "sapwaser",
      "instance_name": "ERS00",
      "reachability": false
    }
  ],
  "NWP": [
    #{
      "addresses": [
        "2.1.1.82"
      ],
      "hostname": "sapnwpas",
      "instance_name": "ASCS00",
      "reachability": true
    }
  ]
}
```

### sapinstance_hostname_resolver

**Argument required**: no.

This gatherer uses the filesystem to search for SAP systems using the discovered profile file names to get the virtual hostnames associated to each
instance of the sap system. It then attempts to resolve those hostnames to confirm that they are resolvable and afterwards it will attempt a ping
to those hostnames. Keep in mind that ping could be disallowed through firewall rules so it should only be used for networks in which we know this is
not true.

Example specification:

```yaml
facts:
  - name: resolvability_check
    gatherer: sapinstance_hostname_resolver
```

Example output (in Rhai):

```ts

// 2 resolvable & 1 non-resolvable hosts
#{
  "NWP": [
    #{
      "addresses": [
        "2.1.1.82"
      ],
      "hostname": "sapnwpas",
      "instance_name": "ASCS00",
      "reachability": true
    }
  ],
  "QAS": [
    #{
      "addresses": [
        "1.1.1.82"
      ],
      "hostname": "sapqasas",
      "instance_name": "ASCS00",
      "reachability": true
    },
    #{
      "addresses": (),
      "hostname": "sapwaser",
      "instance_name": "ERS00",
      "reachability": false
    }
  ]
}
```

<span id="sap_profilesv1"></span>

### sap_profiles@v1

**Argument required**: no.

This gatherer allows access to the latest SAP profile files content stored in `/sapmnt/<SID>/profile`.
The "latest" profile means that backed up files like `DEFAULT.1.PFL` or `some_profile.1` are excluded.
It returns the profile files and content grouped by SID in a key\value way.

Example specification:

```yaml
facts:
  - name: sap_profiles
    gatherer: sap_profiles
```

Example output (in Rhai):

```ts
#{
  "NWP": #{
    "profiles": [
      #{
        "content": #{
          "SAPDBHOST": "10.80.1.13",
          "SAPGLOBALHOST": "sapnwpas",
          "SAPSYSTEMNAME": "NWP",
          ...
        },
        "name": "DEFAULT.PFL",
        "path": "/sapmnt/NWP/profile/DEFAULT.PFL"
      },
      #{
        "content": #{
          "DIR_CT_RUN": "$(DIR_EXE_ROOT)$(DIR_SEP)$(OS_UNICODE)$(DIR_SEP)linuxx86_64",
          "DIR_EXECUTABLE": "$(DIR_INSTANCE)/exe",
          "DIR_PROFILE": "$(DIR_INSTALL)$(DIR_SEP)profile",
          ...
        },
        "name": "NWP_ASCS00_sapnwpas",
        "path": "/sapmnt/NWP/profile/NWP_ASCS00_sapnwpas"
      },
      ...
    ]
  },
  "NWD": #{
    "profiles": [
      #{
        "content": #{
          "SAPDBHOST": "10.85.1.13",
          "SAPGLOBALHOST": "sapnwdas",
          "SAPSYSTEMNAME": "NWD",
          ...
        },
        "name": "DEFAULT.PFL",
        "path": "/sapmnt/NWD/profile/DEFAULT.PFL"
      },
      ...
    ]
  }
}
```

<span id="saptunev1"></span>

### saptune@v1

**Argument required**: yes.

This gatherer allows access to certain commands that `saptune` implements. An argument is required to specify
which argument should be used when calling `saptune`.

> Note: the gatherer will return the same JSON objects returned by saptune. The only transformation it applies is the snake casing of the keys.

Supported arguments:

- `status` (maps to `saptune --format json status --non-compliance-check`)
- `solution-verify` (maps to `saptune --format json solution verify`)
- `solution-list` (maps to `saptune --format json solution list`)
- `note-verify` (maps to `saptune --format json note verify`)
- `note-list` (maps to `saptune --format json note list`)

A `status` call with a successful return should look like this:

Example specification:

```yaml
facts:
  - name: status
    gatherer: saptune
    argument: status
```

Example output (in Rhai):

```ts
// status
#{
  "$schema": "file:///usr/share/saptune/schemas/1.0/saptune_status.schema.json",
  "argv": "saptune --format json status",
  "command": "status",
  "exit_code": 1,
  "messages": [
    #{
      "message": "actions.go:85: ATTENTION: You are running a test version",
      "priority": "NOTICE"
    }
  ],
  "pid": 6593,
  "publish_time": "2023-09-15 15:15:14.599",
  "result": #{
    "configured_version": "3",
    "notes_applied": [
      "1410736"
    ],
    "notes_applied_by_solution": [],
    "notes_enabled": [
      "1410736"
    ],
    "notes_enabled_additionally": [
      "1410736"
    ],
    "notes_enabled_by_solution": [],
    "package_version": "3.1.0",
    "remember_message": "This is a reminder",
    "services": #{
      "sapconf": [],
      "saptune": [
        "disabled",
        "inactive"
      ],
      "tuned": []
    },
    "solution_applied": [],
    "solution_enabled": [],
    "staging": #{
      "notes_staged": [],
      "solutions_staged": [],
      "staging_enabled": false
    },
    "systemd_system_state": "degraded",
    "tuning_state": "compliant",
    "virtualization": "kvm"
  }
}
```

<span id="sbd_configv1"></span>

### sbd_config@v1

**Argument required**: yes.

This gatherer allows accessing the information contained in `/etc/sysconfig/sbd`

Example arguments:

| Name            | Return value                    |
| :-------------- | :------------------------------ |
| `SBD_PACEMAKER` | extracted value from the config |
| `SBD_STARTMODE` | extracted value from the config |
| `SBD_DEVICE`    | extracted value from the config |

Example specification:

```yaml
facts:
  - name: sbd_pacemaker
    gatherer: sbd_config
    argument: SBD_PACEMAKER

  - name: sbd_startmode
    gatherer: sbd_config
    argument: SBD_STARTMODE

  - name: sbd_device
    gatherer: sbd_config
    argument: SBD_DEVICE
```

Example output (in Rhai):

```ts
// sbd_pacemaker
"yes";

// sbd_startmode
"always";

// sbd_device
"/dev/vdc;/dev/vdb";
```

<span id="sbd_dumpv1"></span>

### sbd_dump@v1

**Argument required**: no.

This gatherer allows accessing the sbd dump command output data.

It executes the `sbd -d <device> dump` command in all devices configured in the `SBD_DEVICE` field on `/etc/sysconfig/sbd` and aggregates results in only one fact.

Note that:

- no arguments are required
- if any of the dumps fail, a fact error is returned

Dumped keys (`Timeout (watchdog)`, `Timeout (msgwait)`, `Number of slots`, etc) are sanitized to simplify their access and usage in the expression language.

Example specification:

```yaml
facts:
  - name: sbd_devices_dump
    gatherer: sbd_dump
```

Example output (in Rhai):

```ts
// sbd_devices_dump
#{
    "/dev/vdc": #{
        header_version: 2.1,
        number_of_slots: 255,
        sector_size: 512,
        timeout_allocate: 2,
        timeout_loop: 1,
        timeout_msgwait: 10,
        timeout_watchdog: 5,
        uuid: "69048391-c647-4b34-a03a-f704f5cc2258"
    }
};
```

For extra information refer to [trento-project/agent/../gatherers/sbddump_test.go](https://github.com/trento-project/agent/blob/main/internal/factsengine/gatherers/sbddump_test.go)

<span id="sysctlv1"></span>

### sysctl@v1

**Argument required**: yes.

Gather sysctl output. It takes a sysctl key as argument and it returns the value of the requested key or a map if a partial key is provided.

Example arguments:

| Name            | Return value                                          |
| :-------------- | :---------------------------------------------------- |
| `vm.swappiness` | corresponding value returned by sysctl                |
| `debug`         | a map containing all the keys starting with `debug.`` |

```yaml
facts:
  - name: vm_swappiness
    gatherer: sysctl
    argument: vm.swappiness

  - name: debug
    gatherer: sysctl
    argument: debug
```

Example output (in Rhai):

```ts
// vm_swapiness
60;

// debug
#{
  "exception-trace": 1,
  "kprobes-optimization": 1
};
```

<span id="systemdv1"></span>

### systemd@v1

**Argument required**: yes.

Gather systemd units state. It returns an `active/inactive` string.
If the service is disabled or it does not exist, `inactive` is returned.

Example arguments:

| Name           | Return value              |
| :------------- | :------------------------ |
| `trento-agent` | state of the systemd unit |

```yaml
facts:
  - name: sbd_state
    gatherer: systemd
    argument: sbd

  - name: corosync_state
    gatherer: systemd
    argument: corosync
```

Example output (in Rhai):

```ts
// sbd_state
"active";

// corosync_state
"inactive";
```

<span id="systemdv2"></span>

### systemd@v2

**Argument required**: yes.

Gather systemd units information. It returns an object with multiple fields about the systemd unit.

The provided unit name must include the extension, such as `.service` or `.mount`.

Only a subset of properties are returned. Additional information about these is available in
the [systemd](https://www.man7.org/linux/man-pages/man5/org.freedesktop.systemd1.5.html#UNIT_OBJECTS) man pages,
with some detailed description in the `Properties` sub-chapter.

Example arguments:

| Name                   | Return value             |
| :--------------------- | :----------------------- |
| `trento-agent.service` | systemd unit information |

```yaml
facts:
  - name: corosync
    gatherer: systemd@v2
    argument: corosync.service

  - name: not_found
    gatherer: systemd@v2
    argument: unknown.service
```

Example output (in Rhai):

```ts
// corosync
#{
  "active_state": "inactive",
  "description": "Corosync Cluster Engine",
  "id": "corosync.service",
  "load_state": "loaded",
  "need_daemon_reload": false,
  "unit_file_preset": "disabled",
  "unit_file_state": "disabled"
}

// not_found
#{
  "active_state": "inactive",
  "description": "unknown.service",
  "id": "unknown.service",
  "load_state": "not-found",
  "need_daemon_reload": false,
  "unit_file_preset": "",
  "unit_file_state": ""
}

```

<span id="verify_passwordv1"></span>

### verify_password@v1

**Argument required**: yes.

This gatherer determines whether a given user has its password still set to an unsafe password.
It returns `true` if the password matches a password in the list of unsafe passwords, `false` otherwise.

Specification examples:

```yaml
facts:
  - name: hacluster_has_default_password
    gatherer: verify_password
    argument: hacluster
```

For the argument, only whitelisted users are allowed. Currently whitelisted usernames:

- `hacluster`

List of unsafe passwords:

- `linux`

Example output (in Rhai):

```ts
// hacluster_has_default_password
true;
```</span>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="expression_language.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Expression Language
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="hack_on_wanda.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Hack on Wanda
        </span>
      </a>

  </div>
</div>
      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Wanda.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.30.9) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</main>
</div>


  </body>
</html>
