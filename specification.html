<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.37.1">
    <meta name="project" content="Wanda v1.4.0">


    <title>Checks Specification — Wanda v1.4.0</title>

    <link rel="stylesheet" href="dist/html-elixir-6X3L5KMG.css" />

    <script defer src="dist/sidebar_items-1D7A0A08.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-6XHBGSGW.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="readme.html" class="sidebar-projectImage">
          <img src="assets/logo.svg" alt="Wanda" />
        </a>

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
Wanda
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v1.4.0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras="GUIDES"></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Wanda</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Checks Specification</h1>


      <a href="https://github.com/trento-project/wanda/blob/main/guides/specification.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>

<p>A language allowing to declare best practices to be adhered on target SAP Infrastructures.</p><h2 id="introduction" class="section-heading">
  <a href="#introduction" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Introduction</span>
</h2>
<p>The need this Specification aims to fulfill is to provide users a simple way to declare what we (the Trento Team) often refer to as &quot;Checks&quot;.</p><p>Checks are, in Trento's domain, the crystallization of SUSE's best practices when it comes to SAP workloads in a form that both a user (<a href="#anatomy-of-a-check">Spec</a>) and a machine (<a href="#checks-execution">Execution</a>) can read.</p><p>[^1]: The Trento Team from now on.</p><h2 id="checks-execution" class="section-heading">
  <a href="#checks-execution" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Checks Execution</span>
</h2>
<p><em>Checks Execution</em> is the process that determines whether the best practices defined in the <a href="#anatomy-of-a-check">Checks Specifications</a> are being followed on a target infrastructure.</p><blockquote><p><a href="#requesting-an-execution">Requesting an Execution</a> -&gt; <a href="#facts-gathering">Facts Gathering</a> -&gt; <a href="#expectation-evaluation">Expectation Evaluation</a></p></blockquote><h3 id="requesting-an-execution" class="section-heading">
  <a href="#requesting-an-execution" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Requesting an Execution</span>
</h3>
<p>An Execution can be requested to start by providing Wanda the following information:</p><ul><li>an execution identifier</li><li>an execution Group identifier</li><li>the Checks Selection for the targets (a list of checks to be executed on the targets)</li></ul><p>When the Execution starts running, its current state is stored in the Database and the targets are notified - via the message broker - about Facts to be gathered.</p><p>Then the <em>Execution</em> waits for the <a href="#facts-gathering">Facts Gathering</a> to complete.</p><h3 id="facts-gathering" class="section-heading">
  <a href="#facts-gathering" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Facts Gathering</span>
</h3>
<p>After an <em>Execution Request</em> the targets are notified about the facts they need to <a href="gatherers.html">gather</a>.</p><p>Whenever a target has gathered all the needed facts for an <em>Execution</em>, it notifies Wanda - via the message broker - about the <em>Gathered Facts</em>.</p><h3 id="expectation-evaluation" class="section-heading">
  <a href="#expectation-evaluation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Expectation Evaluation</span>
</h3>
<p><em>Expectation Evaluation</em> is the process of <a href="#expression-language">evaluating</a> the <a href="#expectations">Expectations</a>
using the received <em>Gathered Facts</em> to obtain the result of a check.</p><p>This will only happen once <em>Gathered Facts</em> are received <strong>from all the targets</strong>.</p><p>After the result has been determined, the currently <code class="inline">running</code> Execution transitions to <code class="inline">completed</code> and its new state is tracked on the Database.</p><p>At this point the Execution is considered <strong>Completed</strong> and interested parties are notified about the Execution Completion.</p><h3 id="checks-results" class="section-heading">
  <a href="#checks-results" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Checks Results</span>
</h3>
<p>Once an execution is completed, a checks result should give feedback on what aspects of a target infrastructure adhere to the best practices and which don't.</p><p>Possible results:</p><ul><li><code class="inline">passing</code>, everything ok</li><li><code class="inline">warning</code>, best practice not followed, should fix</li><li><code class="inline">critical</code>, best practice not followed, must fix</li></ul><p>See also <a href="#severity">Check Severity</a>.</p><h2 id="anatomy-of-a-check" class="section-heading">
  <a href="#anatomy-of-a-check" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Anatomy of a Check</span>
</h2>
<p>A Check declaration comes in the form of a <code class="inline">yaml</code> file and all the Checks together build up the <strong>Checks Catalog</strong></p><p>Here's an example:</p><pre><code class="yaml">id: &quot;156F64&quot;
name: Corosync `token` timeout
group: Corosync
description: Corosync `token` timeout is set to the correct value
remediation: |
  ## Abstract
  The value of the Corosync `token` timeout is not set as recommended.
  ## Remediation
  Adjust the corosync `token` timeout as recommended...

severity: warning

metadata:
  target_type: cluster
  cluster_type: hana_scale_up
  hana_scenario: performance_optimized
  provider: [azure, nutanix, kvm, vmware]

facts:
  - name: corosync_token_timeout
    gatherer: corosync.conf
    argument: totem.token

customization_disabled: true

values:
  - name: expected_token_timeout
    customization_disabled: true
    default: 5000
    conditions:
      - value: 30000
        when: env.provider == &quot;azure&quot; || env.provider == &quot;aws&quot;
      - value: 20000
        when: env.provider == &quot;gcp&quot;

expectations:
  - name: token_timeout
    expect: facts.corosync_token_timeout == values.expected_token_timeout</code></pre><h3 id="filename-convention" class="section-heading">
  <a href="#filename-convention" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Filename Convention</span>
</h3>
<p><strong>Note</strong> that a Check's filename <strong>MUST</strong> be in the form <code class="inline">&lt;check_id&gt;.yaml</code> (ie: <code class="inline">156F64.yaml</code>)</p><h3 id="structure" class="section-heading">
  <a href="#structure" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Structure</span>
</h3>
<p>Following are listed the top level properties of a Check definition yaml.</p><table><thead><tr><th style="text-align: left;">Key</th><th style="text-align: left;">Required/Not Required</th><th style="text-align: left;">Details</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">id</code></td><td style="text-align: left;">required</td><td style="text-align: left;"><a href="#id">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">name</code></td><td style="text-align: left;">required</td><td style="text-align: left;"><a href="#name">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">group</code></td><td style="text-align: left;">required</td><td style="text-align: left;"><a href="#group">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">description</code></td><td style="text-align: left;">required</td><td style="text-align: left;"><a href="#description">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">remediation</code></td><td style="text-align: left;">required</td><td style="text-align: left;"><a href="#remediation">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">severity</code></td><td style="text-align: left;">not required</td><td style="text-align: left;"><a href="#severity">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">metadata</code></td><td style="text-align: left;">not required</td><td style="text-align: left;"><a href="#metadata">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">facts</code></td><td style="text-align: left;">required</td><td style="text-align: left;"><a href="#facts">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">customization_disabled</code></td><td style="text-align: left;">not required</td><td style="text-align: left;"><a href="#disable-customization">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">values</code></td><td style="text-align: left;">not required</td><td style="text-align: left;"><a href="#values">see more</a></td></tr><tr><td style="text-align: left;"><code class="inline">expectations</code></td><td style="text-align: left;">required</td><td style="text-align: left;"><a href="#expectations">see more</a></td></tr></tbody></table><hr class="thin"/><h4>id</h4><p>Uniquely identifies a Check in the Catalog. The value must be a hexadecimal number formatted as string using quotes.</p><p>ie:</p><pre><code class="yaml">id: &quot;156F64&quot;
id: &quot;845CC9&quot;
id: &quot;B089BE&quot;</code></pre><h4>name</h4><p>A, preferably one-line, string representing the name for the Check being declared.</p><p>ie:</p><pre><code class="yaml">name: Corosync `token` timeout
name: Corosync `consensus` timeout
name: SBD Startmode</code></pre><h4>group</h4><p>A, preferably one-line, string representing the group where the Check being declared belongs.</p><p>Example:</p><pre><code class="yaml">group: Corosync
group: Pacemaker
group: SBD</code></pre><h4>description</h4><p>A text providing a description for the Check being declared.</p><p>can be a one-liner</p><pre><code class="yaml">description: Some plain description</code></pre><p>can be a multiline text</p><pre><code class="yaml">description: |
  Some plain multiline
  description that carries a lot
  of information</code></pre><p>format is <strong>markdown</strong></p><pre><code class="yaml">description: |
  A `description` is a **markdown**</code></pre><h4>remediation</h4><p>A text providing an comprehensive description about the remediation to apply for the Check being declared.</p><p>It has the same properties of the <code class="inline">description</code></p><ul><li>can be a one-liner (it usually is not)</li><li>can be a multiline (it usually is)</li><li>format is <strong>markdown</strong></li></ul><p>Example:</p><pre><code class="yaml">remediation: |
  ## Abstract
  The value of the Corosync `token` timeout is not set as recommended.
  ## Remediation
  Adjust the corosync `token` timeout as recommended on the best 
  ...
  2. Reload the corosync configuration:
  ...</code></pre><h4>severity</h4><p>A string determining the severity of the Check being declared, in case the check is not passing, so that the appropriate result is reported.</p><p>Allowed values: <code class="inline">warning</code>, <code class="inline">critical</code></p><p><strong>Default:</strong> if no severity is provided, the system would default to <code class="inline">critical</code></p><p>Example:</p><p>Reports a <code class="inline">warning</code> When the Check expectations do not pass</p><pre><code class="yaml">severity: warning</code></pre><p>Reports a <code class="inline">critical</code> When the Check expectations do not pass</p><pre><code class="yaml">severity: critical</code></pre><h4>metadata</h4><p>A key-value map that enriches the Check being declared by providing extra information about when to consider it as applicable given a specific <a href="#env">env</a></p><ul><li>keys must be non empty strings (<code class="inline">foo</code>, <code class="inline">bar</code>, <code class="inline">foo_bar</code>, <code class="inline">qux1</code>)</li><li>values can be any of the following types <code class="inline">string</code>, <code class="inline">number</code>, <code class="inline">boolean</code>, <code class="inline">string[]</code> (list of strings)</li><li><code class="inline">target_type</code> is a <strong>required</strong> key of the <code class="inline">metadata</code> map. It's value is  a <code class="inline">string</code>.</li></ul><p>Example:</p><pre><code class="yaml">metadata:
  target_type: example_target
  foo: bar
  bar: 42
  baz: true
  qux: [foo, bar, baz]</code></pre><p>Metadata is used when:</p><ul><li>querying checks from the catalog</li><li>loading relevant checks for an execution (when requesting an execution to start either via the rest API or via a message through the message broker)</li></ul><h4>How does the matching work?</h4><p>For each of the metadata key-value the system checks whether a matching key is present in the current context (catalog or execution env) and if so, whether the value matches the one declared in the check.</p><p>For a check to be considered applicable all the metadata key-value pairs should match something in the env.</p><p>Any extra key in the env not having a corresponding one in the check metadata is ignored.</p><p>Notes:</p><ul><li>a string in the env (ie <code class="inline">env.qux</code> being <code class="inline">baz</code>) can match either a plain string as in <code class="inline">qux: baz</code> and a string contained in a list as in <code class="inline">qux: [foo, bar, baz]</code></li><li>an empty env always matches any metadata</li><li>an empty metadata always matches any env</li></ul><p><strong>Matching example</strong></p><pre><code class="ts">let env = #{
  foo: &quot;bar&quot;,
  qux: &quot;baz&quot;
}</code></pre><pre><code class="yaml">metadata:
  foo: bar
  bar: 42
  baz: true
  qux: baz</code></pre><p><strong>Not matching example</strong></p><pre><code class="ts">let env = #{
  foo: &quot;bar&quot;,
  qux: &quot;baz&quot;,
  baz: false
}</code></pre><pre><code class="yaml">metadata:
  foo: bar
  bar: 42
  baz: true
  qux: [foo, bar, baz]</code></pre><h4>Facts, Values, Expectations</h4><p>See main sections <a href="#facts">Facts</a>, <a href="#values">Values</a>, <a href="#expectations">Expectations</a></p><h2 id="facts" class="section-heading">
  <a href="#facts" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Facts</span>
</h2>
<p>Facts are the core data on which the engine evaluates the state of the target infrastructure.
Examples include (but are not limited to) installed packages, cluster state, and configuration files content.</p><p>The process of determining the value of a declared fact during Check execution is referred to as <em>Facts Gathering</em> and it is the responsibility of the <a href="gatherers.html"><em>Gatherers</em></a>.
Gatherers could be seen as functions that have a name and accept argument(s).</p><p>That said, a fact declaration contains:</p><ul><li>the fact name</li><li>the gatherer used to retrieve the fact</li><li>the argument(s) to be provided to the gatherer</li></ul><p><strong>Note:</strong></p><ul><li>many facts can be declared</li><li>all the declared facts would be registered in the <a href="#facts-1"><code class="inline">facts</code></a> namespaced evaluation scope.</li></ul><pre><code class="yaml">facts:
  - name: &lt;fact_name&gt;
    gatherer: &lt;gatherer_name&gt;
    argument: &lt;gatherer_argument&gt;

  - name: &lt;another_fact_name&gt;
    gatherer: &lt;another_gatherer_name&gt;
    argument: &lt;another_gatherer_argument&gt;</code></pre><p>The following example declares a <strong>fact</strong> named <code class="inline">corosync_token_timeout</code>, retrievable via the built-in <code class="inline">corosync.conf</code> <strong>gatherer</strong> to which will be provided the <strong>argument</strong> <code class="inline">totem.token</code></p><pre><code class="yaml">facts:
  - name: corosync_token_timeout
    gatherer: corosync.conf
    argument: totem.token

  # other facts maybe</code></pre><p>Finally, gathered facts, are used in Check's <a href="#expectations">Expectations</a> to determine whether expected conditions are met for the best practice to be adhered.</p><h2 id="disable-customization" class="section-heading">
  <a href="#disable-customization" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Disable Customization</span>
</h2>
<p>Users can modify a check's <a href="#values">expected values</a> to accommodate specific system and environmental configurations.</p><p>By default, built-in checks are <strong>customizable</strong>. The <code class="inline">customization_disabled</code> flag provides a way to <strong>disable</strong> customizability when needed.  </p><p>To disable customization for a check the following bit of specification is required:</p><pre><code class="yaml">customization_disabled: true</code></pre><p>Opting out from customizability at the root of a check's specification makes all the values of the given check not customizable.</p><h3 id="notes" class="section-heading">
  <a href="#notes" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Notes:</span>
</h3>
<ul><li>Setting <code class="inline">customization_disabled: false</code> has no real effect as by default a check is customizable</li><li>The <code class="inline">customization_disabled</code> flag can be also applied to <a href="#customizable-values">specific values</a></li></ul><h2 id="values" class="section-heading">
  <a href="#values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Values</span>
</h2>
<p>Values are named variables that may evaluate differently based on the execution context and are used with Facts for <em>Contextual</em> <a href="#expectations">Expectations</a> Evaluation.</p><blockquote><p>When contextual expectations is not needed, there's the following options available:</p><ul><li>use <a href="#hardcoded-values"><strong>hardcoded</strong></a> values</li><li>define <code class="inline">values</code> as <a href="#constant-values"><strong>constants</strong></a></li></ul><p>Scenario:</p><p>No matter what the context is, the fact <code class="inline">awesome_fact</code> MUST always be <code class="inline">wanda</code></p></blockquote><h3 id="hardcoded-values" class="section-heading">
  <a href="#hardcoded-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Hardcoded Values</span>
</h3>
<p>Direct usage of a simple hardcoded value</p><pre><code class="yaml">expectations:
  - name: awesome_expectation
    expect: facts.awesome_fact == &quot;wanda&quot;</code></pre><h3 id="constant-values" class="section-heading">
  <a href="#constant-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Constant Values</span>
</h3>
<p>Define a Value with only the <code class="inline">default</code> specified (<strong>omitting</strong> <code class="inline">conditions</code>) for <strong>constants</strong> regardless of the context.</p><pre><code class="yaml">values:
  - name: awesome_constant_value
    default: &quot;wanda&quot;

expectations:
  - name: awesome_expectation
    expect: facts.awesome_fact == values.awesome_constant_value</code></pre><h3 id="contextual-values" class="section-heading">
  <a href="#contextual-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Contextual Values</span>
</h3>
<p>This is needed because the same check might expect facts to be treated differently based on the context.</p><blockquote><p>Let's clarify with an example:</p><p>A Check might define a fact named <code class="inline">awesome_fact</code> which is expected to be different given the <em>color</em> of the execution.</p><ul><li>it has to be <code class="inline">cat</code> when the <code class="inline">color</code> in the execution context is <code class="inline">red</code></li><li>it has to be <code class="inline">dog</code> when the <code class="inline">color</code> in the execution context is <code class="inline">blue</code></li><li>it has to be <code class="inline">rabbit</code> in all other cases, regardless of the execution context</li></ul><p>so we define a named variable <code class="inline">awesome_expectation</code> that resolves to <code class="inline">cat|dog|rabbit</code> when proper conditions are met</p><p>allowing us to have an expectation like this</p><p><code class="inline">expect: facts.awesome_fact == values.awesome_expectation</code></p></blockquote><p>A Value declaration contains:</p><ul><li>the value name</li><li>the default value</li><li>a list of conditions that determine the value given the context (optional, see <a href="#constant-values">constant values</a>)</li></ul><pre><code class="yaml">values:
  - name: &lt;value_name&gt;
    default: &lt;default_value&gt;
    conditions:
      - value: &lt;value_on_condition_a&gt;
        when: &lt;expression_a&gt;
      - value: &lt;value_on_condition_b&gt;
        when: &lt;expression_b&gt;</code></pre><p>It could read as:</p><p>the value named <code class="inline">&lt;value_name&gt;</code> resolves to</p><ul><li><code class="inline">&lt;value_on_condition_a&gt;</code> when <code class="inline">&lt;expression_a&gt;</code> is true</li><li><code class="inline">&lt;value_on_condition_b&gt;</code> when <code class="inline">&lt;expression_b&gt;</code> is true</li><li><code class="inline">&lt;default_value&gt;</code> in all other cases</li></ul><p>Example:</p><blockquote><p>Check <code class="inline">156F64 Corosync token timeout is set to expected value</code> defines a fact <code class="inline">corosync_token_timeout</code> which is expected to be different given the platform (aws/azure/gcp), so we define a named variable <code class="inline">expected_token_timeout</code> resolving to the appropriate value.</p><p><code class="inline">expected_token_timeout</code> resolves to:</p><ul><li><code class="inline">30000</code> when <code class="inline">azure</code>/<code class="inline">aws</code> are detected</li><li><code class="inline">20000</code> on <code class="inline">gcp</code></li><li><code class="inline">5000</code> in all other cases (ie: bare metal, VMs...)</li></ul></blockquote><pre><code class="yaml">values:
  - name: expected_token_timeout
    default: 5000
    conditions:
      - value: 30000
        when: env.provider == &quot;azure&quot; || env.provider == &quot;aws&quot;
      - value: 20000
        when: env.provider == &quot;gcp&quot;

expectations:
  - name: corosync_token_timeout_is_correct
    expect: facts.corosync_token_timeout == values.expected_token_timeout</code></pre><p>Note that <code class="inline">conditions</code> is a cascading chain of contextual inspection to determine which is the resolved value.</p><ul><li>there may be many conditions</li><li>first condition that passes determines the value, following are not evaluated</li><li><code class="inline">when</code> entry <a href="#expression-language">Expression</a> has <a href="#evaluation-scope">access</a> to gathered <a href="#facts-1">facts</a> and <a href="#env">env</a> evaluation scopes</li></ul><p>All the <em>resolved</em> declared values would be registered in the <a href="#values-1"><code class="inline">values</code></a> namespaced evaluation scope.</p><h3 id="customizable-values" class="section-heading">
  <a href="#customizable-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Customizable Values</span>
</h3>
<p>A check's <a href="#values">expected values</a> are customizable by default, and to provide finer control to the global-level <a href="#disable-customization">customizability opt-out</a> it is possible to opt-out customizability on a per-value basis.</p><pre><code class="yaml">values:
  - name: non_customizable_check_value
    customization_disabled: true
    default: 5000</code></pre><p>Setting <strong>customization_disabled</strong>: <code class="inline">false</code> for a specific value prevents the modification of the default value.</p><h2 id="expectations" class="section-heading">
  <a href="#expectations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Expectations</span>
</h2>
<p>Expectations are assertions on the state of a target infrastructure for a given scenario. By using fact and values they are able to determine if a check passes or not.</p><p>An Expectation declaration contains:</p><ul><li>the expectation name</li><li>the expectation expression itself with <a href="#evaluation-scope">access</a> to gathered <a href="#facts-1">facts</a> and <a href="#values-1">resolved values</a></li><li>an optional <a href="#failure_message">failure message</a></li><li>an optional <a href="#warning_message">warning message</a>, only available in <a href="#expect_enum">expect_enum</a> expectations</li></ul><pre><code class="yaml">expectations:
  - name: &lt;expectation_name&gt;
    expect: &lt;expectation_expression&gt;

  - name: &lt;another_expectation_name&gt;
    expect: &lt;another_expectation_expression&gt;
    failure_message: &lt;something_went_wrong&gt;

  - name: &lt;yet_another_expectation_name&gt;
    expect_same: &lt;yet_another_expectation_expression&gt;</code></pre><p>Extra considerations:</p><ul><li>there can be many expectations for a single Check</li><li>an expectation can be one of three types: <a href="#expect"><code class="inline">expect</code></a>, <a href="#expect_same"><code class="inline">expect_same</code></a> or <a href="#expect_enum"><code class="inline">expect_enum</code></a></li><li>a Check passes when all the expectations are satisfied</li></ul><p>Example</p><pre><code class="yaml">expectations:
  - name: token_timeout
    expect: facts.corosync_token_timeout == values.expected_token_timeout

  - name: awesome_expectation
    expect: facts.awesome_fact == values.awesome_expected_value</code></pre><p>In the previous example a Checks passes (is successful) if all expectations are met, meaning that</p><pre><code class="makeup elixir" translate="no"><span class="n">facts</span><span class="o">.</span><span class="n">corosync_token_timeout</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">values</span><span class="o">.</span><span class="n">expected_token_timeout</span><span class="w">
</span><span class="nc">AND</span><span class="w">
</span><span class="n">facts</span><span class="o">.</span><span class="n">awesome_fact</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">values</span><span class="o">.</span><span class="n">awesome_expected_value</span></code></pre><h3 id="expect" class="section-heading">
  <a href="#expect" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">expect</span>
</h3>
<p>This type of expectation is satisfied when, after facts gathering, the expression is <code class="inline">true</code> for all the targets involved in the current execution.</p><blockquote><p>Execution Scenario:</p><ul><li>2 targets [<code class="inline">A</code>, <code class="inline">B</code>]</li><li>selected Checks [<code class="inline">corosync_check</code>]</li><li>some environment (context)</li></ul><pre><code class="yaml">facts:
  - name: corosync_token_timeout
    gatherer: corosync.conf
    argument: totem.token

values: ...

expectations:
  - name: corosync_token_timeout_is_correct
    expect: facts.corosync_token_timeout == values.expected_token_timeout</code></pre></blockquote><p>Considering the previous scenario what happens is that:</p><ul><li>the fact <code class="inline">corosync_token_timeout</code> is gathered on all targets (<code class="inline">A</code> and <code class="inline">B</code> in this case)</li><li>the expectation expression gets executed against the <code class="inline">corosync_token_timeout</code> fact gathered on every targets.<ul><li><code class="inline">targetA.corosync_token_timeout == values.expected_token_timeout</code></li><li><code class="inline">targetB.corosync_token_timeout == values.expected_token_timeout</code></li></ul></li><li>every evaluation has to be <code class="inline">true</code></li></ul><h3 id="expect_same" class="section-heading">
  <a href="#expect_same" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">expect_same</span>
</h3>
<p>This type of expectation is satisfied when, after facts gathering, the expression's return value is the same for all the targets involved in the current execution, regardless of the value itself.</p><blockquote><p>Execution Scenario:</p><ul><li>2 targets [<code class="inline">A</code>, <code class="inline">B</code>, <code class="inline">C</code>]</li><li>selected Checks [<code class="inline">some_check</code>]</li><li>some environment (context)</li></ul><pre><code class="yaml">expectations:
  - name: awesome_expectation
    expect_same: facts.awesome_fact</code></pre></blockquote><p>Considering the previous scenario what happens is that:</p><ul><li>the fact <code class="inline">awesome_fact</code> is gathered on all targets (<code class="inline">A</code>, <code class="inline">B</code> and <code class="inline">C</code> in this case)</li><li>the expectation expression gets executed for every target involved.<ul><li><code class="inline">targetA.facts.awesome_fact</code></li><li><code class="inline">targetB.facts.awesome_fact</code></li><li><code class="inline">targetC.facts.awesome_fact</code></li></ul></li><li>the expressions results has to be the same for every target<ul><li><code class="inline">targetA.facts.awesome_fact == targetB.facts.awesome_fact == targetC.facts.awesome_fact</code></li></ul></li></ul><blockquote><p>Example:</p><p>RPM version must be the same on all the targets, regardless of what version it is</p><pre><code class="yaml">facts:
  - name: installed_rpm_version
    gatherer: package_version
    argument: rpm

expectations:
  - name: installed_rpm_version_must_be_the_same_on_all_targets
    expect_same: facts.installed_rpm_version</code></pre></blockquote><h3 id="expect_enum" class="section-heading">
  <a href="#expect_enum" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">expect_enum</span>
</h3>
<p>This type of expectation is satisfied when, after facts gathering, the expression returns <code class="inline">passing</code>, <code class="inline">warning</code> or <code class="inline">critical</code>.
If no value is returned, the result defaults to <code class="inline">critical</code>.
The final result of this expectation is the aggretation of all the expectation evaluations gathered in all the involved targets.</p><p>The aggregation returns:</p><ul><li><code class="inline">passing</code> if all the targets evaluation is <code class="inline">passing</code></li><li><code class="inline">warning</code> if any of the evaluations is <code class="inline">warning</code> and there is not any <code class="inline">critical</code> result</li><li><code class="inline">critical</code> if any of the evaluations is <code class="inline">critical</code></li></ul><p>In this expectation type the <a href="#severity">severity</a> field of the check is ignored.</p><blockquote><p>Execution Scenario:</p><ul><li>2 targets [<code class="inline">A</code>, <code class="inline">B</code>]</li><li>selected Checks [<code class="inline">sbd_check</code>]</li><li>some environment (context)</li></ul><pre><code class="yaml">facts:
  - name: sbd_devices
    gatherer: sbd_config@v1
    argument: SBD_DEVICE

values: ...

expectations:
  - name: multiple_sbd_devices_configured
    expect_enum: |
      if facts.sbd_devices &gt; values.passing_sbd_devices_count {
       &quot;passing&quot;
      } else if facts.sbd_devices == values.warning_sbd_devices_count {
       &quot;warning&quot;
      } else {
       &quot;critical&quot;
      }

  - name: multiple_sbd_devices_configured_simple
    expect_enum: |
      if facts.sbd_devices &gt; values.passing_sbd_devices_count {
       &quot;passing&quot;
      } else if facts.sbd_devices == values.warning_sbd_devices_count {
       &quot;warning&quot;
      }
</code></pre></blockquote><p>Considering the previous scenario what happens is that:</p><ul><li>the fact <code class="inline">sbd_devices</code> is gathered on all targets (<code class="inline">A</code> and <code class="inline">B</code> in this case)</li><li>the expectation expression gets executed against the <code class="inline">sbd_devices</code> fact gathered on every targets.</li><li>the evaluated value is exactly what the expression returns. If there is not any returned value, <code class="inline">critical</code> is returned, as in the 2nd expectation example.</li><li>the evaluation result of all the targets is aggregated to compose the final expectation result.</li></ul><h3 id="failure_message" class="section-heading">
  <a href="#failure_message" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">failure_message</span>
</h3>
<p>An optional failure message can be declared for every expectation.</p><p>In case of an <code class="inline">expect</code> one, the failure message can interpolate <code class="inline">facts</code> and <code class="inline">values</code> present in the check definition to provide more meaningful insights:</p><pre><code class="yaml">expectations:
  - name: awesome_expectation
    expect: values.awesome_constant_value == facts.awesome_fact
    failure_message: The expectation did not match ${values.awesome_constant_value}</code></pre><p>The outcome of the interpolation is available in <code class="inline">ExpectationEvaluation</code> inside the API response.</p><p>In case of an <code class="inline">expect_same</code> one, the failure message has to be a plain string:</p><pre><code class="yaml">expectations:
  - name: awesome_expectation
    expect_same: facts.awesome_fact
    failure_message: Boom!</code></pre><p>This plain string is available in <code class="inline">ExpectationResult</code> inside the API response.</p><h3 id="warning_message" class="section-heading">
  <a href="#warning_message" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">warning_message</span>
</h3>
<p>An optional warning message that works exactly as the previous <a href="#failure_message">failure message</a>.
This field is only available for <a href="#expect_enum">expect_enum</a> expectations, and it is interpolated when the expectation outcome is <code class="inline">warning</code>.</p><pre><code class="yaml">expectations:
  - name: awesome_expectation
    expect_enum: |
      if values.passing_value == facts.awesome_fact {
        &quot;passing&quot;
      } else if values.warning_value == facts.awesome_fact {
        &quot;warning&quot;
      }
    failure_message: Critical!
    warning_message: Warning!</code></pre><p>The outcome of the interpolation is available in <code class="inline">ExpectationEvaluation</code> inside the API response, in the <code class="inline">failure_message</code> field.</p><h2 id="expression-language" class="section-heading">
  <a href="#expression-language" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Expression Language</span>
</h2>
<p>Different parts of the Check declaration are places where an evaluation is needed.</p><blockquote><p>Determine to what a <a href="#values">value</a> resolves during execution</p><p><code class="inline">when: &lt;expression&gt;</code> part of a Value's condition</p></blockquote><pre><code class="yaml">values:
  - name: expected_token_timeout
    default: 5000
    conditions:
      - value: 30000
        when: env.provider == &quot;azure&quot; || env.provider == &quot;aws&quot;
      - value: 20000
        when: env.provider == &quot;gcp&quot;</code></pre><blockquote><p>Defining the <a href="#expectations">Expectation</a> of a Check</p><p><code class="inline">expect|expect_same: &lt;expression&gt;</code></p></blockquote><pre><code class="yaml">expectations:
  - name: token_timeout
    expect: facts.corosync_token_timeout == values.expected_token_timeout</code></pre><p>See <a href="expression_language.html">reference for the Expression Language</a>.</p><h3 id="evaluation-scope" class="section-heading">
  <a href="#evaluation-scope" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Evaluation Scope</span>
</h3>
<p>Every expression has access to an evaluation scope, allowing to access relevant piece of information to run the expression.</p><p>Scopes are namespaced and access to items in the scope is name based.</p><h4><strong>env</strong></h4><p><code class="inline">env</code> is a map of information about the context of the running execution, it is set by the system on each execution/check compilation.</p><p>Examples of entries in the scope. What is actually available during the execution depends on the scenario. Find the updated values in the reference column link.</p><table><thead><tr><th style="text-align: left;">name</th><th style="text-align: left;">Type</th><th style="text-align: left;">Reference</th><th style="text-align: left;">Applicable</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">env.target_type</code></td><td style="text-align: left;">one of <code class="inline">cluster</code>, <code class="inline">host</code></td><td style="text-align: left;">No enum available</td><td style="text-align: left;">All</td></tr><tr><td style="text-align: left;"><code class="inline">env.provider</code></td><td style="text-align: left;">one of <code class="inline">azure</code>, <code class="inline">aws</code>, <code class="inline">gcp</code>,<code class="inline">kvm</code>,<code class="inline">nutanix</code>, <code class="inline">vmware</code>, <code class="inline">unknown</code></td><td style="text-align: left;"><a href="https://github.com/trento-project/web/blob/main/lib/trento/enums/provider.ex">Providers</a></td><td style="text-align: left;">All</td></tr><tr><td style="text-align: left;"><code class="inline">env.cluster_type</code></td><td style="text-align: left;">one of <code class="inline">hana_scale_up</code>, <code class="inline">hana_scale_out</code>, <code class="inline">ascs_ers</code>, <code class="inline">unknown</code></td><td style="text-align: left;"><a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/enums/cluster_type.ex">Cluster types</a></td><td style="text-align: left;"><code class="inline">target_type</code> is <code class="inline">cluster</code></td></tr><tr><td style="text-align: left;"><code class="inline">env.hana_scenario</code></td><td style="text-align: left;">one of <code class="inline">performance_optimized</code>, <code class="inline">cost_optimized</code>, <code class="inline">unknown</code></td><td style="text-align: left;"><a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/enums/hana_scenario.ex">Hana Scale Up Scenario</a></td><td style="text-align: left;"><code class="inline">cluster_type</code> is <code class="inline">hana_scale_up</code></td></tr><tr><td style="text-align: left;"><code class="inline">env.architecture_type</code></td><td style="text-align: left;">one of <code class="inline">classic</code>, <code class="inline">angi</code></td><td style="text-align: left;"><a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/enums/hana_architecture_type.ex">Architecture types</a></td><td style="text-align: left;"><code class="inline">cluster_type</code> is one of <code class="inline">hana_scale_up</code>, <code class="inline">hana_scale_out</code></td></tr><tr><td style="text-align: left;"><code class="inline">env.ensa_version</code></td><td style="text-align: left;">one of <code class="inline">ensa1</code>, <code class="inline">ensa2</code>, <code class="inline">mixed_versions</code></td><td style="text-align: left;"><a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/enums/cluster_ensa_version.ex">ENSA version</a></td><td style="text-align: left;"><code class="inline">cluster_type</code> is <code class="inline">ascs_ers</code></td></tr><tr><td style="text-align: left;"><code class="inline">env.filesystem_type</code></td><td style="text-align: left;">one of <code class="inline">resource_managed</code>, <code class="inline">simple_mount</code>, <code class="inline">mixed_fs_types</code></td><td style="text-align: left;"><a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/enums/filesystem_type.ex">Filesystem type</a></td><td style="text-align: left;"><code class="inline">cluster_type</code> is <code class="inline">ascs_ers</code></td></tr></tbody></table><h4><strong>facts</strong></h4><p><code class="inline">facts</code> is the map of the gathered facts, thus the scope varies based on which facts have been declared in the <a href="#facts">relative section</a>, and are accessible in other sections by fact name.</p><pre><code class="yaml">facts:
  - name: an_interesting_fact
    gatherer: &lt;some_gatherer&gt;
    argument: &lt;some_argument&gt;

  - name: another_interesting_fact
    gatherer: &lt;another_gatherer_name&gt;
    argument: &lt;another_gatherer_argument&gt;</code></pre><p>Available entries in scope, the value is what has been gathered on the targets
| name<br/>| -----------------------------
| <code class="inline">facts.an_interesting_fact</code><br/>| <code class="inline">facts.another_interesting_fact</code></p><h4><strong>values</strong></h4><p><code class="inline">values</code> is the map of resolved variable names defined in the <a href="#values">relative section</a></p><pre><code class="yaml">values:
  - name: expected_token_timeout
    default: 5000
    conditions:
      - value: 30000
        when: env.provider == &quot;azure&quot; || env.provider == &quot;aws&quot;
      - value: 20000
        when: env.provider == &quot;gcp&quot;

  - name: another_variable_value
    default: &quot;blue&quot;
    conditions:
      - value: &quot;red&quot;
        when: env.should_be_red == true</code></pre><p>Available entries in scope
| name                            | Resolved to                                      |
| ------------------------------- | ------------------------------------------------ |
| <code class="inline">values.expected_token_timeout</code> | <code class="inline">5000</code>, <code class="inline">30000</code>, <code class="inline">20000</code> based on the conditions |
| <code class="inline">values.another_variable_value</code> | <code class="inline">blue</code>, <code class="inline">red</code> based on the conditions            |</p><h2 id="best-practices-and-conventions" class="section-heading">
  <a href="#best-practices-and-conventions" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Best practices and conventions</span>
</h2>
<p>To have a standardized format for writing checks, follow the next best practices and conventions as much as possible:</p><ul><li><p>The <code class="inline">id</code> field must be wrapped in double quotes to avoid any type of ambiguity, as this field must be of string format.</p></li><li><p>The remaining <code class="inline">name</code>, <code class="inline">description</code>, <code class="inline">group</code>, and <code class="inline">remediation</code> fields must not be wrapped in quotes, as they are text-based values always.</p></li><li><p>Take advantage of markdown tags in the <code class="inline">name</code>, <code class="inline">description</code>, and <code class="inline">remediation</code> fields to make the text easy and compelling to read.</p></li><li><p>The <code class="inline">name</code> field of <code class="inline">facts</code>, <code class="inline">values</code>, and <code class="inline">expectations</code> must follow <code class="inline">camel_case</code> format.<br/>For example:</p><pre><code class="makeup elixir" translate="no"><span class="ss">facts</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">some_fact</span><span class="w">
</span><span class="n">...</span><span class="w">
</span><span class="ss">values</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">expected_some_fact</span><span class="w">
</span><span class="n">...</span><span class="w">
</span><span class="ss">expectations</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">some_expectation</span><span class="w">
</span><span class="n">...</span></code></pre></li><li><p>Use 2 spaces to indent multiline expectation expressions.</p></li><li><p>Naming hardcoded values in the <code class="inline">values</code> section with the <code class="inline">default</code> field is encouraged instead of putting hardcoded values in the expectation expression itself. This gives some meaning to the expected value and improves potential interaction with the Wanda API.<br/>So this:</p><pre><code class="makeup elixir" translate="no"><span class="ss">expectations</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">some_expectation</span><span class="w">
    </span><span class="ss">expect</span><span class="p">:</span><span class="w"> </span><span class="n">facts</span><span class="o">.</span><span class="n">foo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span></code></pre><p>would be:</p><pre><code class="makeup elixir" translate="no"><span class="ss">values</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">expected_foo</span><span class="w">
    </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w">

</span><span class="ss">expectations</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">some_expectation</span><span class="w">
    </span><span class="ss">expect</span><span class="p">:</span><span class="w"> </span><span class="n">facts</span><span class="o">.</span><span class="n">foo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">values</span><span class="o">.</span><span class="n">expected_foo</span></code></pre></li><li><p>If the gathered fact is compared to a value, using <code class="inline">value</code> and <code class="inline">expected_value</code> names for facts and values respectively is recommended, as it improves the meaning of the comparison.<br/>For example:</p><pre><code class="makeup elixir" translate="no"><span class="ss">facts</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">some_fact</span><span class="w">
</span><span class="n">...</span><span class="w">
</span><span class="ss">values</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">expected_some_fact</span><span class="w">
</span><span class="n">...</span></code></pre></li><li><p>Avoid adding prefixes such as <code class="inline">facts</code> or <code class="inline">values</code> to the entries of these sections, as they already use this as a namespace.
For example, the next example should be avoided, as the <code class="inline">facts</code> prefix would be redundant in the expectation expression:</p><pre><code class="makeup elixir" translate="no"><span class="ss">facts</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">facts_some_fact</span></code></pre></li><li><p>If the implemented expectation expression contains any kind of <code class="inline">&amp;&amp;</code> to combine multiple operations, consider adding them as individual expectations, as the final result is the combination of all of them.<br/>So this:</p><pre><code class="makeup elixir" translate="no"><span class="ss">expectations</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">some_expectation</span><span class="w">
    </span><span class="ss">expect</span><span class="p">:</span><span class="w"> </span><span class="n">facts</span><span class="o">.</span><span class="n">foo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">values</span><span class="o">.</span><span class="n">expected_foo</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">facts</span><span class="o">.</span><span class="n">bar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">values</span><span class="o">.</span><span class="n">expected_bar</span></code></pre><p>would be:</p><pre><code class="makeup elixir" translate="no"><span class="ss">expectations</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">foo_expectation</span><span class="w">
    </span><span class="ss">expect</span><span class="p">:</span><span class="w"> </span><span class="n">facts</span><span class="o">.</span><span class="n">foo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">values</span><span class="o">.</span><span class="n">expected_foo</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">bar_expectation</span><span class="w">
    </span><span class="ss">expect</span><span class="p">:</span><span class="w"> </span><span class="n">facts</span><span class="o">.</span><span class="n">bar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">values</span><span class="o">.</span><span class="n">expected_bar</span></code></pre></li><li><p>Pipe the expression language functions vertically in order to provide a better visual output of the code.<br/>So this:</p><pre><code class="makeup elixir" translate="no"><span class="ss">expectations</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">some_expectation</span><span class="w">
    </span><span class="ss">expect</span><span class="p">:</span><span class="w"> </span><span class="n">facts</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">find</span><span class="p" data-group-id="4216942111-1">(</span><span class="o">|</span><span class="n">item</span><span class="o">|</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;super&quot;</span><span class="p" data-group-id="4216942111-1">)</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">find</span><span class="p" data-group-id="4216942111-2">(</span><span class="o">|</span><span class="n">prop</span><span class="o">|</span><span class="w"> </span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;good&quot;</span><span class="p" data-group-id="4216942111-2">)</span><span class="o">.</span><span class="n">value</span></code></pre><p>would be:</p><pre><code class="makeup elixir" translate="no"><span class="ss">expectations</span><span class="p">:</span><span class="w">
  </span><span class="o">-</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">some_expectation</span><span class="w">
    </span><span class="ss">expect</span><span class="p">:</span><span class="w"> </span><span class="o">|</span><span class="w">
      </span><span class="n">facts</span><span class="o">.</span><span class="n">foo</span><span class="w">
      </span><span class="o">.</span><span class="n">find</span><span class="p" data-group-id="1663576967-1">(</span><span class="o">|</span><span class="n">item</span><span class="o">|</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;super&quot;</span><span class="p" data-group-id="1663576967-1">)</span><span class="o">.</span><span class="n">properties</span><span class="w">
      </span><span class="o">.</span><span class="n">find</span><span class="p" data-group-id="1663576967-2">(</span><span class="o">|</span><span class="n">prop</span><span class="o">|</span><span class="w"> </span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;good&quot;</span><span class="p" data-group-id="1663576967-2">)</span><span class="o">.</span><span class="n">value</span></code></pre><blockquote><p>Note: Keep in mind that some functions such as <code class="inline">sort</code> and <code class="inline">drain</code> run in-place modifications, so they cannot be piped.</p></blockquote></li></ul>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="rhai_expressions_cheat_sheet.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Rhai expressions cheatsheet
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="expression_language.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Expression Language
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Wanda.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.37.1) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
